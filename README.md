

# TLRS_task

- В проекте реализовано CRUD-приложение для управления информацией о пользователе, его контактах, фото и система авторизации с JWT токенами.
- Предусмотрено два варианта запуска: локальный и с DOKER.
- В корне проекта в папке `postman` приложен скрипт для тестирования API.

## Стек технологий
Проект построен с использованием следующих технологий:
- **Spring Boot** — основной фреймворк приложения.
- **Spring Web** — для создания REST API.
- **Spring Security + JWT** — аутентификация и авторизация с токенами доступа.
- **Spring Data JPA + Hibernate** — доступ к базе данных PostgreSQL.
- **PostgreSQL** — основная СУБД.
- **Redis** — используется при необходимости для кеширования.
- **MinIO** — хранение файлов (фото пользователей, текущие настройки до 10MB).
- **Resilience4j** — Circuit Breaker для устойчивости интеграций (например, MinIO).
- **Springdoc OpenAPI** — автоматическая генерация Swagger UI.

## Интегрированы в проект на перспективу:

- Поддержка **расширяемых контактов** (например, адрес, Telegram) без изменения сервисных классов.
- **Actuator + Micrometer**: реализован мониторинг (пока только для MinIO).
- **Flyway** — управление миграциями БД (в проекте предусмотрен скрипт миграции 1, сейчас по умолчанию Flyway отключён).
- **Refresh-токены**: предусмотрены, можно включить в `application.properties` - `jwt.use.refresh=false` — переключает использование. На текущей стадии проверена работоспособность только access token.

---
## Запуск проекта
Предусмотрено два варианта запуска: локальный и с DOKER.

### 1. Локальный запуск без Docker

- В файле `src/main/resources/application.properties` настроены параметры подключения к базе данных PostgreSQL, MinIO и Redis.
- Для работы необходимо запустить локально сервисы PostgreSQL, MinIO и Redis в соответствии с application.properties.
- После запуска сервисов, в терминале из корня проекта выполните:
```bash
./mvnw clean spring-boot:run
````
или
```bash
java -jar target/TLRS_task-1.0-SNAPSHOT.jar --spring.profiles.active=local
```
Приложение будет доступно по адресу:
```
http://localhost:8080
```

---
### 2. Запуск с помощью Docker Compose

- В проекте есть `Dockerfile` и `docker-compose.yml`, которые позволяют поднять все необходимые сервисы (PostgreSQL, Redis, MinIO, само приложение).
- Для запуска выполните:
```bash
docker compose up --build
```
- В Docker Compose приложение использует профиль `docker`, настройки которого находятся в `src/main/resources/application-docker.properties`.
- После успешного запуска все сервисы будут доступны по стандартным портам.

---
## Интерфейсы и консоли

- **Swagger UI** (документация API):
```
http://localhost:8080/swagger-ui.html
или
http://localhost:8080/swagger-ui/index.html
```

- **MinIO Console** (управление объектным хранилищем):
```
http://localhost:9001
Логин: minioadmin
Пароль: minioadmin
```

---
## Тестирование API через Postman
В папке `postman` приложена Postman-коллекция для удобного тестирования API.

### Рекомендуемый порядок тестирования:

1. **Регистрация пользователя**
    - Выполните запрос `POST /api/auth/register` для создания нового пользователя.
2. **Авторизация (логин)**
    - Выполните запрос `POST /api/auth/login` с данными зарегистрированного пользователя, чтобы получить JWT токены.
3. **Заполнение профиля пользователя**
    - Используйте полученный access token для доступа к эндпоинтам заполнения профиля (`POST /api/users/profile`).
4. **Дальнейшие действия**
    - После создания профиля можно выполнять CRUD операции с контактами, фотографиями и другими ресурсами.
